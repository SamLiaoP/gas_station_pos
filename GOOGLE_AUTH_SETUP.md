# Google 認證設置指南

為了使用Google登入功能，您需要在Google Cloud Console上設置OAuth 2.0憑證。請按照以下步驟操作：

## 第一步：建立Google Cloud項目

1. 訪問 [Google Cloud Console](https://console.cloud.google.com/)
2. 點擊頁面頂部的項目下拉選單，然後點擊「新建項目」
3. 輸入項目名稱（例如「加油站POS系統」），並點擊「建立」
4. 等待項目創建完成後，確保已選擇該項目

## 第二步：設置OAuth同意屏幕

1. 在左側菜單中，選擇「API和服務」> 「OAuth 同意屏幕」
2. 選擇「外部」用戶類型（如果這只是測試用途，可以選擇「測試」），然後點擊「創建」
3. 填寫應用程式名稱（例如「加油站POS系統」）、用戶支持郵箱和開發者聯絡信息
4. 點擊「儲存並繼續」
5. 在「範圍」頁面上，點擊「添加或刪除範圍」，然後選擇以下範圍：
   - `openid`
   - `email`
   - `profile`
6. 點擊「更新」並「儲存並繼續」
7. 在「測試用戶」頁面上，如果您選擇了「測試」用戶類型，添加您的Gmail地址作為測試用戶
8. 點擊「儲存並繼續」
9. 檢查摘要，然後點擊「回到儀表板」

## 第三步：建立OAuth客戶端ID

1. 在左側菜單中，選擇「API和服務」>「憑證」
2. 點擊頂部的「+ 建立憑證」按鈕，然後選擇「OAuth客戶端ID」
3. 在「應用程式類型」下拉選單中，選擇「Web 應用程式」
4. 在「名稱」欄位中，輸入「加油站POS系統」
5. 在「授權的重定向URI」部分，點擊「+ 添加URI」
6. 添加以下URI：
   - `http://localhost:8080/login/google/callback`
   - `http://127.0.0.1:8080/login/google/callback`
   - 如果您的應用將在其他域名或IP上運行，也需要添加相應的回調URL
7. 點擊「建立」
8. 系統會顯示您的客戶端ID和客戶端密鑰。記下這些值，您將需要它們配置應用程式

## 第四步：配置應用程式

1. 開啟 `set_env.sh` 檔案
2. 將您的客戶端ID和客戶端密鑰添加到相應的位置：
   ```bash
   export GOOGLE_CLIENT_ID='您的客戶端ID'
   export GOOGLE_CLIENT_SECRET='您的客戶端密鑰'
   ```
3. 修改 `config.py` 檔案中的 `AUTHORIZED_EMAILS` 清單，添加您希望授權登入系統的Google郵箱地址

## 第五步：執行應用程式

1. 在終端機中執行：
   ```bash
   source ./set_env.sh
   python run.py
   ```
2. 訪問 `http://127.0.0.1:8080` 開始使用系統

## 故障排除

- 如果出現「無法連接到Google認證服務」錯誤，請確認您的網絡連接正常，且客戶端ID和密鑰正確設置
- 如果出現「您無權訪問系統」錯誤，請確認您的郵箱已添加到 `config.py` 的授權清單中
- 如果回調URL出現錯誤，請確認您已在Google Cloud Console添加了正確的重定向URI

## 生產環境配置

在生產環境中，建議執行以下操作：

1. 使用環境變數或私密管理服務存儲客戶端ID和密鑰，而不是寫入檔案
2. 添加您的生產域名到Google Cloud Console的重定向URI清單
3. 設置正確的OAuth同意屏幕並發布應用程式
4. 使用HTTPS協議保護所有連接 